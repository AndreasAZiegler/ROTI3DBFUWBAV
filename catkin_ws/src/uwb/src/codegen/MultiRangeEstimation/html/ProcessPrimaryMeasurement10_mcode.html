<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%% Compute time-of-flight, range and time-of-flight in DW timeunits of primary UWB unit</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S36T3U229">tof</span>, <span class="var type1" id="S37T3U230">range</span>] = ProcessPrimaryMeasurement( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">    <span class="var type1" id="S38T3U233">timestamp_master_request_1_recv</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="var type1" id="S39T3U234">timestamp_slave_reply_send</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    <span class="var type1" id="S40T3U235">timestamp_master_request_2_recv</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">    <span class="var type1" id="S41T1U236">timestamp_master_request_1_array</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    <span class="var type1" id="S42T1U237">timestamp_slave_reply_array</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="var type1" id="S43T1U238">timestamp_master_request_2_array</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">    <span class="var type1" id="S44T4U239">params</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">)</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">    <span class="mxinfo " id="T3:U10"><span class="var type1" id="S45T3U242">timediff_slave</span> = <span class="mxinfo " id="T3:U12"><span class="mxinfo " id="T3:U13"><span class="var type1" id="S38T3U245">timestamp_master_request_1_recv</span> + <span class="var type1" id="S40T3U246">timestamp_master_request_2_recv</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">                     - <span class="mxinfo " id="T3:U16"><span class="mxinfo " id="T3:U17">2</span> * <span class="var type1" id="S39T3U249">timestamp_slave_reply_send</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">    <span class="mxinfo " id="T3:U19"><span class="var type1" id="S46T3U252">timediff_master</span> = <span class="mxinfo " id="T3:U21"><span class="mxinfo " id="T3:U22"><span class="mxinfo " id="T3:U23"><span class="mxinfo " id="T3:U24">2</span> * <span class="mxinfo " id="T3:U25"><span class="var type1" id="S42T1U258">timestamp_slave_reply_array</span>(<span class="mxinfo " id="T3:U27">1</span>)</span></span> - <span class="mxinfo " id="T3:U28"><span class="var type1" id="S41T1U261">timestamp_master_request_1_array</span>(<span class="mxinfo " id="T3:U30">1</span>)</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">                      - <span class="mxinfo " id="T3:U31"><span class="var type1" id="S43T1U264">timestamp_master_request_2_array</span>(<span class="mxinfo " id="T3:U33">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">%     if ~coder.target('MATLAB')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="comment">%         coder.ceval('printf', ['timediff_slave: %f\n' 10 0], timediff_slave);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="comment">%         coder.ceval('printf', ['timediff_master: %f\n' 10 0], timediff_master);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    <span class="mxinfo " id="T3:U34"><span class="var type1" id="S36T3U268">tof</span> = <span class="mxinfo " id="T3:U36"><span class="mxinfo " id="T3:U37"><span class="fcn" id="F2N3:B271">ConvertDWTimeunitsToMicroseconds</span>(<span class="mxinfo " id="T3:U38"><span class="var type1" id="S46T3U273">timediff_master</span> + <span class="var type1" id="S45T3U274">timediff_slave</span></span>, <span class="var type1" id="S44T4U275">params</span>)</span> / <span class="mxinfo " id="T3:U42">4.0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    <span class="mxinfo " id="T3:U43"><span class="var type1" id="S37T3U279">range</span> = <span class="mxinfo " id="T3:U45"><span class="fcn" id="F9N4:B281">ConvertTimeOfFlightToDistance</span>(<span class="var type1" id="S36T3U282">tof</span>, <span class="var type1" id="S44T4U283">params</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">%% Compute clock offset and skew of slave UWB unit</span></span></span>
</pre>
