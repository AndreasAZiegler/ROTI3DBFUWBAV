<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"><span class="comment">%% Compute clock offset and skew of secondary UWB unit</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S64T3U358">clock_offset</span>, <span class="var type1" id="S65T3U359">clock_skew</span>] = ProcessSecondaryMeasurement( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">    <span class="var type1" id="S66T3U362">index</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">    <span class="var type1" id="S67T1U363">timestamp_master_request_1_array</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">    <span class="var type1" id="S68T1U364">timestamp_master_request_2_array</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">    <span class="var type1" id="S69T4U365">params</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">)</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">    <span class="comment">% clock offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">    <span class="mxinfo " id="T3:U7"><span class="var type1" id="S70T3U368">timestamp_primary</span> = <span class="mxinfo " id="T3:U9"><span class="var type1" id="S67T1U370">timestamp_master_request_1_array</span>(<span class="mxinfo " id="T3:U11">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">    <span class="mxinfo " id="T3:U12"><span class="var type1" id="S71T3U374">timestamp_secondary</span> = <span class="mxinfo " id="T3:U14"><span class="var type1" id="S67T1U376">timestamp_master_request_1_array</span>(<span class="var type1" id="S66T3U377">index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">    <span class="mxinfo " id="T3:U17"><span class="var type1" id="S64T3U380">clock_offset</span> = <span class="mxinfo " id="T3:U19"><span class="mxinfo " id="T3:U20"><span class="var type1" id="S71T3U383">timestamp_secondary</span> - <span class="var type1" id="S70T3U384">timestamp_primary</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        - <span class="mxinfo " id="T3:U23"><span class="mxinfo " id="T3:U24"><span class="mxinfo " id="T1:U25"><span class="var type1" id="S69T4U388">params</span>.unit_distances</span>(<span class="var type1" id="S66T3U390">index</span>)</span> / <span class="mxinfo " id="T3:U28"><span class="var type1" id="S69T4U392">params</span>.SPEED_OF_LIGHT_IN_M_PER_DW_TIMEUNIT</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">    <span class="comment">% clock skew</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">    <span class="mxinfo " id="T3:U30"><span class="var type1" id="S72T3U396">clock_diff_1</span> = double( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="mxinfo " id="T3:U32"><span class="mxinfo " id="T3:U33"><span class="var type1" id="S68T1U401">timestamp_master_request_2_array</span>(<span class="mxinfo " id="T3:U35">1</span>)</span> - <span class="mxinfo " id="T3:U36"><span class="var type1" id="S67T1U404">timestamp_master_request_1_array</span>(<span class="mxinfo " id="T3:U38">1</span>)</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">    )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">    <span class="mxinfo " id="T3:U39"><span class="var type1" id="S74T3U408">clock_diff_2</span> = double( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">        <span class="mxinfo " id="T3:U41"><span class="mxinfo " id="T3:U42"><span class="var type1" id="S68T1U413">timestamp_master_request_2_array</span>(<span class="var type1" id="S66T3U414">index</span>)</span> - <span class="mxinfo " id="T3:U45"><span class="var type1" id="S67T1U416">timestamp_master_request_1_array</span>(<span class="var type1" id="S66T3U417">index</span>)</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">    )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">    <span class="mxinfo " id="T3:U48"><span class="var type1" id="S65T3U420">clock_skew</span> = <span class="mxinfo " id="T3:U50">(<span class="mxinfo " id="T3:U51"><span class="mxinfo " id="T3:U52"><span class="mxinfo " id="T3:U53">1</span> / <span class="var type1" id="S74T3U426">clock_diff_2</span></span> - <span class="mxinfo " id="T3:U55"><span class="mxinfo " id="T3:U56">1</span> / <span class="var type1" id="S72T3U429">clock_diff_1</span></span></span>) / (<span class="mxinfo " id="T3:U58"><span class="mxinfo " id="T3:U59">1</span> / <span class="var type1" id="S72T3U433">clock_diff_1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="comment">%% Convert DW timeunit into microseconds</span></span></span>
</pre>
