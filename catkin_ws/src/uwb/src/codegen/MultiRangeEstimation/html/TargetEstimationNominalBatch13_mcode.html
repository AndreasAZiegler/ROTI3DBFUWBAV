<pre class="code">
<span class="srcline"><span class="lineno"><a href="7,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T7U3">x_out</span> ] = TargetEstimationNominalBatch( <span class="var type1" id="S3T1U6">rangeArray</span>,<span class="var type1" id="S4T8U7">params</span>,<span class="var type1" id="S5T9U8">pos_init</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="7,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%UNTITLED Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% model</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,5" id="srcline5">  5</a></span><span class="line">coder.cstructname(<span class="var type0" id="S4T0U14">params</span>, <span class="string">'TargetEstimationParams'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="7,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,7" id="srcline7">  7</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S7T3U17">initialized</span> <span class="var type1" id="S8T7U18">x</span> <span class="var type1" id="S9T10U19">P</span> <span class="var type0" id="S10T0U20">tailStates</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo " id="T3:U8"><span class="var type1" id="S11T3U23">numTail</span>=<span class="mxinfo " id="T3:U10">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T3:U11"><span class="var type1" id="S12T3U27">numStatesTail</span>=<span class="mxinfo " id="T3:U13">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T3:U14"><span class="var type1" id="S13T3U31">numStates</span>=<span class="mxinfo " id="T3:U16">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,11" id="srcline11"> 11</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T5:U17">isempty(<span class="var type0" id="S7T0U37">initialized</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,12" id="srcline12"> 12</a></span><span class="line">    <span class="mxinfo " id="T3:U18"><span class="var type1" id="S7T3U40">initialized</span>=<span class="mxinfo " id="T3:U20">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,13" id="srcline13"> 13</a></span><span class="line">    <span class="mxinfo " id="T10:U21"><span class="var type1" id="S9T10U44">P</span>=<span class="mxinfo " id="T10:U23"><span class="mxinfo " id="T3:U24">10</span>*<span class="mxinfo " id="T10:U25">eye(<span class="var type1" id="S13T3U50">numStates</span>+<span class="var type1" id="S11T3U52">numTail</span>*<span class="var type1" id="S12T3U53">numStatesTail</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,14" id="srcline14"> 14</a></span><span class="line">    <span class="mxinfo " id="T3:U29"><span class="mxinfo " id="T3:U30"><span class="var type1" id="S9T10U57">P</span>(<span class="mxinfo " id="T3:U32">3</span>,<span class="mxinfo " id="T3:U33">3</span>)</span>=<span class="mxinfo " id="T3:U34"><span class="mxinfo " id="T3:U35">0.00</span>*<span class="mxinfo " id="T3:U36">eye(1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,15" id="srcline15"> 15</a></span><span class="line">    <span class="mxinfo " id="T11:U37"><span class="mxinfo " id="T11:U38"><span class="var type1" id="S9T10U68">P</span>(<span class="mxinfo " id="T12:U40"><span class="mxinfo " id="T3:U41">4</span>:<span class="mxinfo " id="T3:U42">6</span></span>,<span class="mxinfo " id="T12:U43"><span class="mxinfo " id="T3:U44">4</span>:<span class="mxinfo " id="T3:U45">6</span></span>)</span>=<span class="mxinfo " id="T11:U46">zeros(<span class="mxinfo " id="T3:U47">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,16" id="srcline16"> 16</a></span><span class="line">    <span class="mxinfo " id="T7:U48"><span class="var type1" id="S8T7U80">x</span>=<span class="mxinfo " id="T7:U50">[<span class="var type1" id="S5T9U83">pos_init</span>;<span class="mxinfo " id="T3:U52">0</span>;<span class="mxinfo " id="T3:U53">0</span>;<span class="mxinfo " id="T3:U54">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,17" id="srcline17"> 17</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="7,18" id="srcline18"> 18</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="7,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T3:U55"><span class="var type1" id="S17T3U92">Range1</span>=<span class="mxinfo " id="T3:U57"><span class="var type1" id="S3T1U94">rangeArray</span>(<span class="mxinfo " id="T3:U59">1</span>)</span></span>;<span class="mxinfo " id="T3:U60"><span class="var type1" id="S18T3U98">Range2</span>=<span class="mxinfo " id="T3:U62"><span class="var type1" id="S3T1U100">rangeArray</span>(<span class="mxinfo " id="T3:U64">2</span>)</span></span>;<span class="mxinfo " id="T3:U65"><span class="var type1" id="S19T3U104">Range3</span>=<span class="mxinfo " id="T3:U67"><span class="var type1" id="S3T1U106">rangeArray</span>(<span class="mxinfo " id="T3:U69">3</span>)</span></span>;<span class="mxinfo " id="T3:U70"><span class="var type1" id="S20T3U110">Range4</span>=<span class="mxinfo " id="T3:U72"><span class="var type1" id="S3T1U112">rangeArray</span>(<span class="mxinfo " id="T3:U74">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T3:U75"><span class="var type1" id="S21T3U116">qv_x</span>=<span class="mxinfo " id="T3:U77">0.2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T3:U78"><span class="var type1" id="S22T3U120">qv_y</span>=<span class="mxinfo " id="T3:U80">0.2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T3:U81"><span class="var type1" id="S23T3U124">qv_z</span>=<span class="mxinfo " id="T3:U83">0.2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T3:U84"><span class="var type1" id="S24T3U128">qp_x</span>=<span class="mxinfo " id="T3:U86">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T3:U87"><span class="var type1" id="S25T3U132">qp_y</span>=<span class="mxinfo " id="T3:U89">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T3:U90"><span class="var type1" id="S26T3U136">qp_z</span>=<span class="mxinfo " id="T3:U92">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo " id="T3:U93"><span class="var type1" id="S27T3U140">dt</span>=<span class="mxinfo " id="T3:U95">1/60</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T11:U96"><span class="var type1" id="S28T11U146">O</span>=<span class="mxinfo " id="T11:U98">zeros(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T11:U99"><span class="var type1" id="S29T11U152">I</span>=<span class="mxinfo " id="T11:U101">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T10:U102"><span class="var type1" id="S30T10U158">Fxx</span>=<span class="mxinfo " id="T10:U104">[<span class="var type1" id="S29T11U161">I</span>,<span class="var type1" id="S27T3U163">dt</span>*<span class="var type1" id="S29T11U164">I</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,36" id="srcline36"> 36</a></span><span class="line">    <span class="var type1" id="S28T11U166">O</span>,<span class="var type1" id="S29T11U167">I</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T10:U110"><span class="var type1" id="S31T10U170">Q_r</span>=<span class="mxinfo " id="T10:U112">diag([<span class="var type1" id="S24T3U175">qp_x</span>,<span class="var type1" id="S25T3U176">qp_y</span>,<span class="var type1" id="S26T3U177">qp_z</span>,<span class="var type1" id="S21T3U178">qv_x</span>,<span class="var type1" id="S22T3U179">qv_y</span>,<span class="var type1" id="S23T3U180">qv_z</span>])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T10:U119"><span class="var type1" id="S33T10U183">Qxx</span>=<span class="mxinfo " id="T10:U121">blkdiag(<span class="var type1" id="S31T10U186">Q_r</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T11:U123"><span class="var type1" id="S35T11U189">R_WB</span>=<span class="mxinfo " id="T11:U125">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T13:U126"><span class="var type1" id="S36T13U195">R</span>=<span class="mxinfo " id="T13:U128"><span class="mxinfo " id="T13:U129">eye(4)</span>*<span class="mxinfo " id="T3:U130">0.03</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo " id="T14:U131"><span class="var type1" id="S37T14U203">o</span>=<span class="mxinfo " id="T14:U133">zeros(<span class="mxinfo " id="T3:U134">3</span>,<span class="mxinfo " id="T3:U135">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T14:U136"><span class="var type1" id="S38T14U210">a</span>=<span class="mxinfo " id="T14:U138">zeros(3,4)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T14:U139"><span class="var type1" id="S39T14U217">b</span>=<span class="mxinfo " id="T14:U141">zeros(3,4)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo " id="T9:U142"><span class="mxinfo " id="T9:U143"><span class="var type1" id="S37T14U225">o</span>(<span class="mxinfo " id="T15:U145">:</span>,<span class="mxinfo " id="T3:U146">1</span>)</span>=<span class="mxinfo " id="T9:U147"><span class="var type1" id="S35T11U229">R_WB</span>*<span class="mxinfo " id="T9:U149"><span class="var type1" id="S4T8U231">params</span>.m_uwb1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo " id="T3:U151"><span class="mxinfo " id="T3:U152"><span class="var type1" id="S38T14U236">a</span>(<span class="mxinfo " id="T6:U154">1</span>)</span>=<span class="mxinfo " id="T3:U155"><span class="var type1" id="S4T8U239">params</span>.UWB1p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo " id="T3:U157"><span class="mxinfo " id="T3:U158"><span class="var type1" id="S39T14U244">b</span>(<span class="mxinfo " id="T6:U160">1</span>)</span>=<span class="mxinfo " id="T3:U161"><span class="var type1" id="S4T8U247">params</span>.UWB1p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T9:U163"><span class="mxinfo " id="T9:U164"><span class="var type1" id="S37T14U252">o</span>(<span class="mxinfo " id="T15:U166">:</span>,<span class="mxinfo " id="T3:U167">2</span>)</span>=<span class="mxinfo " id="T9:U168"><span class="var type1" id="S35T11U256">R_WB</span>*<span class="mxinfo " id="T9:U170"><span class="var type1" id="S4T8U258">params</span>.m_uwb2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo " id="T3:U172"><span class="mxinfo " id="T3:U173"><span class="var type1" id="S38T14U263">a</span>(<span class="mxinfo " id="T6:U175">2</span>)</span>=<span class="mxinfo " id="T3:U176"><span class="var type1" id="S4T8U266">params</span>.UWB2p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo " id="T3:U178"><span class="mxinfo " id="T3:U179"><span class="var type1" id="S39T14U271">b</span>(<span class="mxinfo " id="T6:U181">2</span>)</span>=<span class="mxinfo " id="T3:U182"><span class="var type1" id="S4T8U274">params</span>.UWB2p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T9:U184"><span class="mxinfo " id="T9:U185"><span class="var type1" id="S37T14U279">o</span>(<span class="mxinfo " id="T15:U187">:</span>,<span class="mxinfo " id="T3:U188">3</span>)</span>=<span class="mxinfo " id="T9:U189"><span class="var type1" id="S35T11U283">R_WB</span>*<span class="mxinfo " id="T9:U191"><span class="var type1" id="S4T8U285">params</span>.m_uwb3</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T3:U193"><span class="mxinfo " id="T3:U194"><span class="var type1" id="S38T14U290">a</span>(<span class="mxinfo " id="T6:U196">3</span>)</span>=<span class="mxinfo " id="T3:U197"><span class="var type1" id="S4T8U293">params</span>.UWB3p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T3:U199"><span class="mxinfo " id="T3:U200"><span class="var type1" id="S39T14U298">b</span>(<span class="mxinfo " id="T6:U202">3</span>)</span>=<span class="mxinfo " id="T3:U203"><span class="var type1" id="S4T8U301">params</span>.UWB3p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T9:U205"><span class="mxinfo " id="T9:U206"><span class="var type1" id="S37T14U306">o</span>(<span class="mxinfo " id="T15:U208">:</span>,<span class="mxinfo " id="T6:U209">4</span>)</span>=<span class="mxinfo " id="T9:U210"><span class="var type1" id="S35T11U310">R_WB</span>*<span class="mxinfo " id="T9:U212"><span class="var type1" id="S4T8U312">params</span>.m_uwb4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T3:U214"><span class="mxinfo " id="T3:U215"><span class="var type1" id="S38T14U317">a</span>(<span class="mxinfo " id="T6:U217">4</span>)</span>=<span class="mxinfo " id="T3:U218"><span class="var type1" id="S4T8U320">params</span>.UWB4p0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T3:U220"><span class="mxinfo " id="T3:U221"><span class="var type1" id="S39T14U325">b</span>(<span class="mxinfo " id="T6:U223">4</span>)</span>=<span class="mxinfo " id="T3:U224"><span class="var type1" id="S4T8U328">params</span>.UWB4p1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% prediction</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T7:U226"><span class="var type1" id="S8T7U332">x</span>=<span class="mxinfo " id="T7:U228"><span class="var type1" id="S30T10U334">Fxx</span>*<span class="var type1" id="S8T7U335">x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo " id="T10:U231"><span class="var type1" id="S40T10U338">F</span>=<span class="mxinfo " id="T10:U233">blkdiag(<span class="var type1" id="S30T10U341">Fxx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T10:U235"><span class="var type1" id="S41T10U344">Q</span>=<span class="mxinfo " id="T10:U237">blkdiag(<span class="var type1" id="S33T10U347">Qxx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T10:U239"><span class="var type1" id="S9T10U350">P</span>=<span class="mxinfo " id="T10:U241"><span class="mxinfo " id="T10:U242"><span class="mxinfo " id="T10:U243"><span class="var type1" id="S40T10U354">F</span>*<span class="var type1" id="S9T10U355">P</span></span>*<span class="mxinfo " id="T10:U246"><span class="var type1" id="S40T10U357">F</span>'</span></span>+<span class="var type1" id="S41T10U358">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,65" id="srcline65"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T7:U249"><span class="var type1" id="S42T7U361">n</span>=<span class="var type1" id="S8T7U362">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T9:U252"><span class="var type1" id="S43T9U365">pos</span>=<span class="mxinfo " id="T9:U254"><span class="var type1" id="S8T7U367">x</span>(1:3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo " id="T16:U256"><span class="var type1" id="S44T16U373">InitialRangeArray</span>=<span class="mxinfo " id="T16:U258">[<span class="var type1" id="S17T3U376">Range1</span>;<span class="var type1" id="S18T3U378">Range2</span>;<span class="var type1" id="S19T3U380">Range3</span>;<span class="var type1" id="S20T3U382">Range4</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo " id="T17:U263"><span class="var type1" id="S45T17U385">H</span>=<span class="mxinfo " id="T17:U265">zeros(<span class="mxinfo " id="T3:U266">4</span>,<span class="mxinfo " id="T3:U267">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo " id="T16:U268"><span class="var type1" id="S46T16U392">h</span>=<span class="mxinfo " id="T16:U270">zeros(<span class="mxinfo " id="T3:U271">4</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T18:U272"><span class="var type1" id="S47T18U399">K</span>=<span class="mxinfo " id="T17:U274">zeros(<span class="mxinfo " id="T3:U275">4</span>,<span class="mxinfo " id="T3:U276">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,72" id="srcline72"> 72</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S48T3U406">iter</span>=<span class="mxinfo " id="T3:U278">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="7,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,74" id="srcline74"> 74</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S49T3U412">cntUWB</span>=<span class="mxinfo " id="T3:U280">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="7,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%         a=[0;0;0;0];</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%         b=[1;1;1;1];</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,77" id="srcline77"> 77</a></span><span class="line">        <span class="mxinfo " id="T3:U281"><span class="var type1" id="S50T3U418">h_n</span>=<span class="mxinfo " id="T3:U283">norm(<span class="mxinfo " id="T9:U284"><span class="var type1" id="S43T9U422">pos</span>-<span class="mxinfo " id="T9:U286"><span class="var type1" id="S37T14U424">o</span>(<span class="mxinfo " id="T15:U288">:</span>,<span class="var type1" id="S49T3U426">cntUWB</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,78" id="srcline78"> 78</a></span><span class="line">        <span class="mxinfo " id="T3:U290"><span class="var type1" id="S52T3U429">htmp</span>=<span class="mxinfo " id="T3:U292">(<span class="mxinfo " id="T3:U293"><span class="mxinfo " id="T3:U294">-<span class="mxinfo " id="T3:U295"><span class="var type1" id="S38T14U435">a</span>(<span class="var type1" id="S49T3U436">cntUWB</span>)</span></span>+<span class="var type1" id="S50T3U437">h_n</span></span>)/<span class="mxinfo " id="T3:U299"><span class="var type1" id="S39T14U439">b</span>(<span class="var type1" id="S49T3U440">cntUWB</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,79" id="srcline79"> 79</a></span><span class="line">        <span class="comment">%derivatives</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,80" id="srcline80"> 80</a></span><span class="line">        <span class="mxinfo " id="T3:U302"><span class="var type1" id="S53T3U443">h_to_hn</span>=<span class="mxinfo " id="T3:U304"><span class="mxinfo " id="T3:U305">1</span>/<span class="mxinfo " id="T3:U306"><span class="var type1" id="S39T14U447">b</span>(<span class="var type1" id="S49T3U448">cntUWB</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,81" id="srcline81"> 81</a></span><span class="line">        <span class="mxinfo " id="T12:U309"><span class="var type1" id="S54T12U451">hs_to_x</span>=<span class="mxinfo " id="T12:U311"><span class="mxinfo " id="T12:U312"><span class="mxinfo " id="T3:U313">2</span>*<span class="mxinfo " id="T12:U314"><span class="var type1" id="S43T9U456">pos</span>'</span></span>-<span class="mxinfo " id="T12:U316"><span class="mxinfo " id="T3:U317">2</span>*<span class="mxinfo " id="T12:U318"><span class="mxinfo " id="T9:U319"><span class="var type1" id="S37T14U461">o</span>(<span class="mxinfo " id="T15:U321">:</span>,<span class="var type1" id="S49T3U463">cntUWB</span>)</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,82" id="srcline82"> 82</a></span><span class="line">        <span class="mxinfo " id="T3:U323"><span class="var type1" id="S55T3U466">hn_to_hs</span>=<span class="mxinfo " id="T3:U325"><span class="mxinfo " id="T3:U326">1</span>/(<span class="mxinfo " id="T3:U327"><span class="mxinfo " id="T3:U328">2</span>*<span class="mxinfo " id="T3:U329">sqrt(<span class="var type1" id="S50T3U474">h_n</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,83" id="srcline83"> 83</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="7,84" id="srcline84"> 84</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="7,85" id="srcline85"> 85</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="7,86" id="srcline86"> 86</a></span><span class="line">        <span class="mxinfo " id="T12:U331"><span class="var type1" id="S57T12U477">hn_to_x</span>=<span class="mxinfo " id="T12:U333"><span class="var type1" id="S55T3U479">hn_to_hs</span>*<span class="var type1" id="S54T12U480">hs_to_x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,87" id="srcline87"> 87</a></span><span class="line">        <span class="mxinfo " id="T12:U336"><span class="var type1" id="S58T12U483">h_to_x</span>=<span class="mxinfo " id="T12:U338"><span class="var type1" id="S53T3U485">h_to_hn</span>*<span class="var type1" id="S57T12U486">hn_to_x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,88" id="srcline88"> 88</a></span><span class="line">        <span class="mxinfo " id="T19:U341"><span class="mxinfo " id="T19:U342"><span class="var type1" id="S45T17U490">H</span>(<span class="var type1" id="S49T3U491">cntUWB</span>,<span class="mxinfo " id="T20:U345">:</span>)</span>=<span class="mxinfo " id="T19:U346">[<span class="var type1" id="S58T12U495">h_to_x</span>,<span class="mxinfo " id="T3:U348">0</span>,<span class="mxinfo " id="T3:U349">0</span>,<span class="mxinfo " id="T3:U350">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,89" id="srcline89"> 89</a></span><span class="line">        <span class="mxinfo " id="T3:U351"><span class="mxinfo " id="T3:U352"><span class="var type1" id="S46T16U502">h</span>(<span class="var type1" id="S49T3U503">cntUWB</span>)</span>=<span class="var type1" id="S52T3U504">htmp</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,90" id="srcline90"> 90</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="7,91" id="srcline91"> 91</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,92" id="srcline92"> 92</a></span><span class="line">    <span class="mxinfo " id="T16:U356"><span class="var type1" id="S59T16U507">z</span>=<span class="var type1" id="S44T16U508">InitialRangeArray</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,93" id="srcline93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo " id="T16:U359"><span class="var type1" id="S60T16U511">res</span>=<span class="mxinfo " id="T16:U361"><span class="var type1" id="S59T16U513">z</span>-<span class="var type1" id="S46T16U514">h</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,95" id="srcline95"> 95</a></span><span class="line">    <span class="mxinfo " id="T13:U364"><span class="var type1" id="S61T13U517">S</span>=<span class="mxinfo " id="T13:U366"><span class="mxinfo " id="T13:U367"><span class="mxinfo " id="T17:U368"><span class="var type1" id="S45T17U521">H</span>*<span class="var type1" id="S9T10U522">P</span></span>*<span class="mxinfo " id="T21:U371"><span class="var type1" id="S45T17U524">H</span>'</span></span>+<span class="var type1" id="S36T13U525">R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,96" id="srcline96"> 96</a></span><span class="line">    <span class="mxinfo " id="T18:U374"><span class="var type1" id="S47T18U528">K</span>=<span class="mxinfo " id="T21:U376"><span class="mxinfo " id="T21:U377"><span class="var type1" id="S9T10U531">P</span>*<span class="mxinfo " id="T21:U379"><span class="var type1" id="S45T17U533">H</span>'</span></span>/<span class="var type1" id="S61T13U534">S</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">% chi^2 outlier rejection</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,98" id="srcline98"> 98</a></span><span class="line">    <span class="mxinfo " id="T3:U382"><span class="var type1" id="S62T3U537">mahal</span>=<span class="mxinfo " id="T3:U384">sqrt(<span class="mxinfo " id="T3:U385"><span class="mxinfo " id="T22:U386"><span class="mxinfo " id="T22:U387"><span class="var type1" id="S60T16U543">res</span>'</span>/<span class="var type1" id="S61T13U544">S</span></span>*<span class="var type1" id="S60T16U545">res</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,99" id="srcline99"> 99</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T5:U391"><span class="var type1" id="S62T3U549">mahal</span>&lt;<span class="mxinfo " id="T3:U393">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="7,100" id="srcline100">100</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="7,101" id="srcline101">101</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="7,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,103" id="srcline103">103</a></span><span class="line">        <span class="mxinfo " id="T7:U394"><span class="var type1" id="S42T7U553">n</span>=<span class="mxinfo " id="T7:U396"><span class="var type1" id="S8T7U555">x</span>+<span class="mxinfo " id="T23:U398"><span class="var type1" id="S47T18U557">K</span>*(<span class="mxinfo " id="T16:U400"><span class="var type1" id="S60T16U560">res</span>-<span class="mxinfo " id="T16:U402"><span class="var type1" id="S45T17U562">H</span>*(<span class="mxinfo " id="T7:U404"><span class="var type1" id="S8T7U565">x</span>-<span class="var type1" id="S42T7U566">n</span></span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,104" id="srcline104">104</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="7,105" id="srcline105">105</a></span><span class="line">        <span class="mxinfo " id="T3:U407"><span class="var type1" id="S63T3U569">outl</span>=<span class="mxinfo " id="T3:U409">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,106" id="srcline106">106</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,107" id="srcline107">107</a></span><span class="line">        <span class="mxinfo " id="T3:U410"><span class="var type1" id="S63T3U574">outl</span>=<span class="mxinfo " id="T3:U412">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,108" id="srcline108">108</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,109" id="srcline109">109</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,110" id="srcline110">110</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T5:U413"><span class="var type1" id="S63T3U579">outl</span>==<span class="mxinfo " id="T3:U415">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="7,111" id="srcline111">111</a></span><span class="line">    <span class="comment">% only do update if there was no outlyer</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,112" id="srcline112">112</a></span><span class="line">    <span class="mxinfo " id="T10:U416"><span class="var type1" id="S9T10U583">P</span>=<span class="mxinfo " id="T10:U418">(<span class="mxinfo " id="T10:U419"><span class="mxinfo " id="T10:U420">eye(<span class="var type1" id="S13T3U590">numStates</span>+<span class="var type1" id="S11T3U592">numTail</span>*<span class="var type1" id="S12T3U593">numStatesTail</span>)</span>-<span class="mxinfo " id="T24:U424"><span class="var type1" id="S47T18U595">K</span>*<span class="var type1" id="S45T17U596">H</span></span></span>)*<span class="var type1" id="S9T10U597">P</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,113" id="srcline113">113</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="7,114" id="srcline114">114</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="7,115" id="srcline115">115</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,117" id="srcline117">117</a></span><span class="line"><span class="comment">% copy the new state n after the iterated update into the real state</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo " id="T7:U428"><span class="var type1" id="S8T7U600">x</span>=<span class="var type1" id="S42T7U601">n</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,119" id="srcline119">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,121" id="srcline121">121</a></span><span class="line"><span class="comment">%% state augmentation</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,122" id="srcline122">122</a></span><span class="line"><span class="comment">% find first oldest state</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="7,125" id="srcline125">125</a></span><span class="line"><span class="comment">% copy the state to the output variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T7:U431"><span class="var type1" id="S2T7U604">x_out</span>=<span class="var type1" id="S8T7U605">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T10:U434"><span class="var type1" id="S64T10U608">P_pos_out</span>=<span class="var type1" id="S9T10U609">P</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="7,128" id="srcline128">128</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="7,129" id="srcline129">129</a></span><span class="line"></span></span>
</pre>
